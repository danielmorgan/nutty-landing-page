---
import Icon from "./Icon.astro";

export interface Props {
  id: string;
  title?: string;
}

const { id } = Astro.props;
---

<div
  id={id}
  class="modal fixed inset-0 z-50 flex items-center justify-center opacity-0 invisible pointer-events-none transition-all duration-300 ease-in-out p-4"
  role="dialog"
  aria-modal="true"
  aria-labelledby={`${id}`}
>
  <div
    class="modal-overlay absolute inset-0 bg-[url(/images/pattern-orange.png)] bg-size-[auto_96px] sm:bg-size-[auto_128px] bg-repeat animate-diagonal-scroll-bl cursor-pointer"
    aria-hidden="true"
  >
  </div>
  <div
    class="modal-content p-4 sm:p-8 relative bg-white rounded-xl shadow-2xl max-h-[90vh] w-full max-w-lg transform scale-90 transition-transform duration-300 ease-in-out overflow-hidden flex flex-col"
  >
    <a
      href="#"
      class="modal-close rounded-full text-gray-500 hover:text-gray-700 focus:outline-none transition-colors duration-200 w-auto inline-flex items-center shrink"
      aria-label="Close modal"
      role="button"
    >
      <Icon icon="back" />
      Back
    </a>

    <div class="modal-body flex-1 overflow-y-auto">
      <slot />
    </div>
  </div>
</div>

<style>
  .modal:target {
    @apply opacity-100 visible pointer-events-auto;
  }

  .modal:target .modal-content {
    @apply scale-100;
  }

  /* Prevent body scroll when modal is open */
  .modal:target ~ body,
  body:has(.modal:target) {
    @apply overflow-hidden;
  }
</style>

<script>
  // Minimal JavaScript for escape key and outside click functionality
  document.addEventListener("DOMContentLoaded", () => {
    const modals = document.querySelectorAll(".modal");

    modals.forEach((modal) => {
      const overlay = modal.querySelector(".modal-overlay");

      // Close on escape key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && modal.matches(":target")) {
          window.location.hash = "";
        }
      });

      // Close when clicking overlay
      overlay?.addEventListener("click", () => {
        window.location.hash = "";
      });
    });
  });
</script>
